# creatingdeploying
Develop and deliver apps with Cloud Code, Cloud Build, Google Cloud Deploy, and GKE 
**Architecture overview**
The following diagram shows the resources used in this tutorial:
<img width="494" alt="image" src="https://user-images.githubusercontent.com/75738489/162739012-cda2c525-592a-4947-b2cf-70c2fd509073.png">

**
Objectives**

cting as an operator, you do the following:

Set up the CI pipeline and CD pipeline. This setup includes the following:
Set up the required permissions.
Create the GKE clusters for the staging and production environments.
Create a repository in Cloud Source Repositories for the source code.
Create a repository in Artifact Registry for the application container.
Create a Cloud Build trigger on the main GitHub repository.
Create a Google Cloud Deploy delivery pipeline and targets. The targets are the staging and production environment.
Start the CI/CD process to deploy to staging and then promote to production.
Acting as a developer, you make a change to the application. To do so, you do the following:

Clone the repository to work with a pre-configured development environment.
Make a change to the application within your developer workspace.
Build and test the change. The tests include a validation test for governance.
View and validate the change in a dev cluster. This cluster runs on minikube.
Commit the change into the main repository.

**Before  we begin.**
Make sure that billing is enabled for your Cloud project. Learn how to check if billing is enabled on a project.

Enable the Artifact Registry, Cloud Build, Google Cloud Deploy, Cloud Source Repositories, Google Kubernetes Engine, Resource Manager, and Service Networking APIs usoing terrafomr we have enabale the all the required permissions
**
Prepare your environment**

**using terraform Prepare your environment**

Set up the required permissions.
Create the GKE clusters for the staging and production environments.
Clone the source repository.
Create a repository in Cloud Source Repositories for the source code.
Create a repository in Artifact Registry for the container application.

use this repo code fro all above steps

terraform init
terraform plan
terraform apply

note :chnange your project id and variables.



**once everything is created clusters and evrything clone given source repo,  you  got all the source code

git clone https://github.com/google/golden-path-for-app-delivery.git

cd to clone repo
we created all ready  sourece repo cicd-sample through terraform#.
**
Ensure the Google Cloud Deploy configurations target the correct project:**
1) sed -i s/project-id-placeholder/$(gcloud config get-value project)/g deploy/*
2) git config --global credential.https://source.developers.google.com.helper gcloud.sh
3) git remote add google https://source.developers.google.com/p/$(gcloud config get-value project)/r/cicd-sample

**Push your source code to the repository:**Push your source code to the repository:
git push --all google

next step is we have to create a build trigger for that we have all ready mention in build.tf its created build trigger if we chnage any thing in our source code its automatically trigger the job.

**Configure the CI/CD pipeline**

In this section, you act as the application operator and configure the CI/CD pipeline. The pipeline uses Cloud Build for CI and Google Cloud Deploy for CD. The steps of the pipeline are defined in the Cloud Build trigger.

Create a Cloud Storage bucket for Cloud Build to store the artifacts.json file (which tracks the artifacts generated by Skaffold for each build):



once the build  is triggered its automaticaly pushed to build image and then its deployed to cloud deploy then we have manually promote code  to production server.
The application is deployed in staging, but not in production.

Verify that the application is working successfully in staging:


kubectl proxy --port 8001 --context gke_$(gcloud config get-value project)_us-central1_staging
This command sets up a kubectl proxy to access the application.

Access the application from Cloud Shell:

In Cloud Shell Editor, open a new terminal tab.

Send a request to localhost to increment a counter:


curl -s http://localhost:8001/api/v1/namespaces/default/services/cicd-sample:8080/proxy/ | grep -A 1 Counter
You can run this command multiple times and watch the counter value increment each time.

As you view the app, notice that the text that you changed is in the version of the application you deployed on staging.

Close this second tab.

In the first tab, press Control+C to stop the proxy.

You have now invoked the Cloud Build trigger to start the CI process, which includes building the application, deploying it to the staging environment, and running tests to verify the application is working in staging.

The CI process is successful when the code builds and tests pass in the staging environment. The success of the CI process then initiates the CD system in Google Cloud Deploy.

Promote the release to production
In this section, you promote the release from staging to production. The production target comes pre-configured to require approval, so you manually approve it.

For your own CI/CD pipeline, you might want to use a deployment strategy that launches the deployment gradually before you do a full deployment into production. Launching the deployment gradually can make it easier to detect issues and, if needed, to restore a previous release.

To promote the release to production, do the following:

Open the Google Cloud Deploy delivery pipelines overview and select the cicd-sample pipeline.

Promote the deployment from staging to production. To do so:

In the pipeline diagram at the top of the page, click the blue Promote button in the staging box.

In the window that opens, click the Promote button at the bottom.

The deployment is not yet running in production. It's waiting for the required manual approval.

Manually approve the deployment:

In the pipeline visualization, click the Review button between the staging and production boxes.

In the window that opens, click the Review button.

In the next window, click Approve.

Return to the Google Cloud Deploy delivery pipelines overview and select the cicd-sample pipeline.

After the pipeline visualization shows the prod box as green (meaning a successful rollout), verify that the application is working in production by setting up a kubectl proxy that you use to access the application:


kubectl proxy --port 8002 --context gke_$(gcloud config get-value project)_us-central1_prod
Access the application from Cloud Shell:

In Cloud Shell Editor, open a new terminal tab.

Increment the counter:


curl -s http://localhost:8002/api/v1/namespaces/default/services/cicd-sample:8080/proxy/ | grep -A 1 Counter
You can run this command multiple times and watch the counter value increment each time.

Close this second terminal tab.

In the first tab, press Control+C to stop the proxy.

You've now promoted and approved the production deployment. The application with your recent change is now running in production.





























